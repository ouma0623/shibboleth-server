# 50_app_code.mdc
# Application Implementation Rules

## 1. 目的
アプリコードを「保守・運用前提」で統一する。

---

## 2. 基本原則
- 可読性を最優先
- 小さく・責務を明確に
- 例外・エラーは握りつぶさない

### 2.1 命名規則
- 関数・メソッド：動詞で始める（`getUserData`, `validateInput`）
- クラス・型：名詞で始める（`UserService`, `ValidationError`）
- 定数：大文字スネークケース（`MAX_RETRY_COUNT`）
- 変数：意味のある名前を付ける（`userCount` ではなく `activeUserCount`）

### 2.2 関数・クラスのサイズ目安
- 関数：1関数あたり50行以内を目安（複雑な場合は分割を検討）
- クラス：1クラスあたり300行以内を目安（責務が多すぎる場合は分割を検討）
- ファイル：1ファイルあたり500行以内を目安

### 2.3 責務の分離
- 1つの関数・クラスは1つの責務のみを持つ
- データ取得・処理・出力を分離する
- ビジネスロジックとインフラ層を分離する

---

## 3. ログ・エラーハンドリング

### 3.1 ログ出力
- ログは原因追跡可能な粒度で出す
  - エラー時：エラー内容・入力値・コンテキスト情報を含める
  - 正常時：重要な処理の開始・終了を記録する
- 機密情報は出力しない（パスワード・トークン・個人情報）
- ログレベルを適切に使い分ける（DEBUG / INFO / WARN / ERROR）

### 3.2 エラーハンドリング
- 例外は意味を持ったメッセージで伝播させる
- エラーは握りつぶさない（catchして何もしない、またはログだけ出す）
- エラー発生時は適切なHTTPステータスコード・エラーレスポンスを返す
- リトライ可能なエラーと致命的なエラーを区別する

### 3.3 コメント
- 「なぜそうしているか」を説明する（「何をしているか」はコードで表現）
- 複雑なロジック・ビジネスルールにはコメントを付ける
- TODOコメントは期限・担当者を明記する

---

## 4. 設定管理
- 設定値の直書き禁止
- 環境変数 / 設定ファイルを使用
- 設定仕様は docs に記載する
- 設定値のバリデーションを実装する
- デフォルト値を明示する（環境変数が未設定の場合の挙動を明確化）

---

## 5. テスト
- 最低限のテストを用意する
  - 正常系：主要な処理パスをカバー
  - 異常系：エラーケースをカバー
  - 境界値：入力値の境界をテスト
- テスト観点は Checkログに残す
- テストコードは本番コードと同じ品質基準を適用する
- モック・スタブを適切に使用する（外部依存を排除）

---

## 6. 仕様変更時
- Doで仕様を変えない
- 変更が必要なら Plan に差し戻す
