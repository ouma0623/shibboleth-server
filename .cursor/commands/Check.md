# /check
# PDCA: Check Phase
# Role: QA / Reviewer

## 【このコマンドの位置づけ】
Checkフェーズは「事実確認フェーズ」である。
感想・推測・希望は含めない。

---

## 【ルール理解チェック（必須・省略不可）】
各コマンド実行時、最初に以下を短く宣言してから作業を進める。

- 私は以下を理解し遵守する：
  1) 事実確認のみを行い、感想・推測・希望は含めない
  2) OKでない限りTask IssueをCloseしない
  3) Checkログを必ず記録する（観点・手順・期待結果・実結果・判定）
  4) 妥協してOKにせず、証跡なしでOKと判断しない
  5) Task定義（Plan確定）を書き換えず、新規Taskは作成しない

※ これを省略しない

## 【前提理解チェック（必須）】
- 対象は1つの Task Issue
- OKでない限り Close しない
- Checkログは 10_execution_model.mdc の必須項目を満たさない限りOKにしない
- **AIナレッジ参照**：Obsidian側のAIナレッジディレクトリ（`/mnt/d/work/obsidian/cursor/20_KNOWLEDGE/`）を必ず参照して実施する
- **デプロイ確認**：修正内容を確認する際は、必ずデプロイしてから確認する（ローカル環境のみの確認は不十分）
- **長時間バッチ事前確認**：長時間バッチを実行する際は、テストページやサンプルデータを読み込ませて正確に取得できることを確認してから実行する

---

## 【責務】
- Task が Done 定義を満たしているか検証する
- 結果を明確に残す

---

## 【禁止事項】
- 妥協してOKにすること
- Task定義を書き換えること

---

## 【Operation Plan】

### 1. テスト実行（Run）

#### 1.0 デプロイ確認（必須）
修正内容がある場合、必ずデプロイしてから確認する。

**デプロイ前の確認事項：**
- 変更内容の確認
- 影響範囲の確認
- デプロイ手順の確認

**デプロイ後の確認：**
- デプロイが正常に完了したことの確認
- デプロイ環境での動作確認

#### 1.0.1 長時間バッチ実行前の確認（該当時）
長時間バッチを実行する場合、事前に以下を確認する：

- テストページやサンプルデータを読み込ませて、正確に取得できることを確認する
- バッチの実行時間・リソース使用量を確認する
- エラーハンドリングが適切に実装されていることを確認する
- 実行環境が適切か確認する（本番環境で実行する場合は特に注意）

#### 1.1 自動テスト
- ユニットテストの実行（該当時）
- 統合テストの実行（該当時）
- テスト結果の記録（成功/失敗、カバレッジ）

#### 1.2 手動確認
以下の観点で確認する（Taskの内容に応じて選択）：

**機能確認**
- 要件定義書（docs/01_REQUIREMENTS/requirements.md）に記載された機能が実装されているか
- 正常系の動作が期待通りか
- 異常系の動作が適切に処理されているか
- エラーメッセージが適切か

**UI/UX確認（該当時）**
- 画面表示が正しいか
- 操作性が適切か
- レスポンシブデザインが適切か（該当時）

**パフォーマンス確認（該当時）**
- レスポンスタイムが許容範囲内か
- リソース使用量が適切か
- スケーラビリティに問題がないか

**セキュリティ確認（該当時）**
- 認証・認可が適切に実装されているか
- 機密情報が適切に保護されているか
- 入力値のバリデーションが適切か

**運用確認（該当時）**
- ログが適切に出力されているか
- エラー時の挙動が適切か
- 監視・アラートが設定されているか（インフラ変更時）

#### 1.3 証跡取得
- テスト実行ログを保存する
- スクリーンショットを取得する（UI確認時）
- 手動確認手順を記録する

### 2. 作業ファイル配置（該当時のみ）
> **注意**：検証時に作成された作業ファイル（テスト結果ログ、検証メモ等）がある場合、Obsidian PJディレクトリの `99_work_files/` に配置する。

1) 作業ファイルが作成された場合：
   - Planフェーズで作成されたPJディレクトリを確認する
     - `docs/90_OBSIDIAN/PJ<XXX>-<YYYY-MM>/99_work_files/`
   - 作業ファイルを `99_work_files/` に配置する
   - ファイル名は意味のある名前を付ける（例：`test-result-YYYYMMDD.log`, `verification-memo.md`）

### 3. Task Issue 更新（Update）
Check欄に以下を追記（10_execution_model.mdc の必須項目を満たす）：

**観点**
- どの観点で確認したか（機能 / UI/UX / パフォーマンス / セキュリティ / 運用）

**手順**
- どのように確認したか（テストコード実行 / 手動操作 / ログ確認 など）
- 確認環境（ローカル / ステージング / 本番）

**期待結果**
- Task定義に記載された完了条件
- 仕様書に記載された期待動作

**実結果**
- 実際の動作・結果を具体的に記載
- OKの場合：期待通りに動作したことを明記
- NGの場合：どの点が期待と異なるかを明記

**判定**
- OK / NG を明記
- OKの場合：完了条件を満たしている根拠を記載
- NGの場合：差戻先（Do / Plan）を明記し、理由を記載

### 4. 状態更新
- OK:
  - Task Issue Close
  - 親Plan Issue の Task状態を「完了」に更新
- NG:
  - Closeしない
  - 差戻宣言のみ

---

## 【フェーズ完了条件】
- OK/NG が第三者にも判断可能
- Checkログに観点・手順・期待結果・実結果・判定が記載されている
- OKの場合：Task Issue が Close され、親Plan Issue の Task状態が更新されている
- NGの場合：差戻先が明確に記載されている

---

## 【出力】
- 判定結果
- Task / Plan 更新内容
- 次アクション

---

## 【フェーズ宣言】
Checkフェーズを開始する。
Checkフェーズを終了する。
