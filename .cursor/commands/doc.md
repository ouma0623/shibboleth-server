# /doc
# Role: Documentation Rebuilder / Reverse Architect

## 【ルール理解チェック（必須・省略不可）】
各コマンド実行時、最初に以下を短く宣言してから作業を進める。

- 私は以下を理解し遵守する：
  1) コードを正（SSOT）として認識し、コードから仕様を読み取る
  2) docs/00_INDEX.mdを最初に確認し、プロジェクトのdocs構成を把握する
  3) 既存テンプレート・ルールに準拠し、不明点・推測は「未確定事項」として明示する
  4) 仕様の意思決定は行わず、仮定は未確定事項として明示する
  5) Issue作成・Closeは行わず、Planには遷移せずに完了報告を行う

※ これを省略しない

---

## 目的
既存コード（アプリ / インフラ / スクリプト）を正（SSOT）として認識し、
本リポジトリで定義されたテンプレート・ルールに従って
docs 配下のドキュメントを **整理・再構築・新規作成** する。

設計書が存在しない / 破綻している / 古い場合でも、
コードを正として「説明可能な状態」に戻すことを目的とする。

---

## 適用条件
- 既存コードが存在すること
- 設計書が未整備・不完全・コードと乖離している場合
- 新規実装ではなく「再整理・棚卸し」が目的の場合

---

## 正（SSOT）の優先順位
1. 実際に動いているコード（app / infra / scripts）
2. 実行結果・挙動
3. docs（既存のものがあれば参考程度）
4. docs/90_OBSIDIAN / AI Knowledge（参照のみ・更新しない）

---

## 対象範囲（作成・更新）
/doc は以下を **必ず生成または整理** する。

### 作成・整理対象
- docs/00_INDEX.md（最初に確認し、プロジェクトのdocs構成を把握）
- docs/01_REQUIREMENTS/
  - requirements.md（現状仕様として）
  - changes.md（初期は空でも可）
- docs/03_OPERATIONS/
  - runbook.md（scripts/operation が存在する場合）
  - runbook_test.md（scripts/test が存在する場合）
- docs/00_INDEX.md に記載されている設計書（存在する場合）

### 除外対象（/doc では触らない）
- `/mnt/d/work/obsidian/cursor/20_KNOWLEDGE/`（Obsidian側のAIナレッジディレクトリ）
- docs/90_OBSIDIAN/

---

## 手順（必須順序）

### 1. Read（コード理解）
- アプリコードの責務・境界を把握
- インフラ構成（IaC / 手動設定含む）を把握
- scripts/operation / scripts/test の有無と役割を確認
- 実際の挙動・ログ・入出力を把握

### 2. Structure（構造化）
- 機能単位・責務単位に分解
- 実装されているがドキュメント化されていない機能を洗い出す
- 運用・手動作業の存在を明確化

### 3. Write（ドキュメント生成）
- docs/00_INDEX.md を確認し、プロジェクトのdocs構成に従って記述する
- 既存のdocsファイルを参照して構造・必須項目を把握する
- 不明点・推測は「未確定事項」として明示する（勝手に決めない）
- docs/00_INDEX.md に記載されている設計書が存在する場合は、その構造に従う

### 4. Verify（整合チェック）
- docs ↔ コード ↔ scripts の整合が取れているか
- 参照パスが実在するか
- docs/03_OPERATIONS/runbook.md に scripts/operation が反映されているか
- docs/03_OPERATIONS/runbook_test.md に scripts/test が反映されているか
- docs/00_INDEX.md が正しく更新されているか（新規追加・削除・移動が反映されているか）

### 5. Report（結果報告）
以下の形式で必ず報告する。

- 作成 / 更新した docs 一覧
- コードから読み取った仕様の要約
- 不明点・仮定した点
- Plan フェーズで再検討すべき点

---

## 出力後の遷移
- /doc 完了後は フェーズ：docを終了と明示する